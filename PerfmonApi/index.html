<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>stats</title>
</head>
<body>
	<h2>demo</h2>

	<script>
		const STATS_EVENT = 'stats';

		(function connect() {
			console.log('connecting');
			const ws = new WebSocket(`ws://${location.host}/socket`);
			ws.onmessage = ({data}) => window.dispatchEvent(new CustomEvent(STATS_EVENT, { detail: JSON.parse(data) }));
			ws.onclose = () => setTimeout(connect, 5000);
		})();

		window.addEventListener(STATS_EVENT, ({detail}) => console.log('DATA', detail));
	</script>
</body>
</html>